<!DOCTYPE html>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

{% include head.html %}

<body>

    {% include header.html %} 
    <script
    src="https://www.paypal.com/sdk/js?client-id=AfPXI6xS8kZLXEBXVNF8VdA6t_6g5ZUaLjnut-H7bnKYT9sdWZ_cr98VI32hpi5CC2AXMntBPovJsLUo"></script>
    
    
<!-- Main -->
<div id="main" class="alt">

<section id="two" style="border:0;">
	<div class="inner">
		<div class="row 100% uniform">
			<div class="12u 12u$(medium)" style="padding-right: 1em;">
		      	<header class="major">
					<h1>Checkout</h1>
				</header>
			</div>
		    <div class="8u 12u$(medium)" style="padding-right: 2em;">
		    	<h3>Your Dolly order</h3>
				<div style="margin-bottom: 0.5em">
					<ul id="params-list"></ul>
					<table class="alt" id="my-table">
						<tbody>
							<tr>
								<td width="50%">
									<p>Guitar</p>
								</td>
								<td width="50%">
									<span value="${{page.price-usd}}" id="final-total" name="total-price">$1900</span>
								</td>
							</tr>
							<tr>
								<td>
									<p>Shipping</p>
								</td>
								<td>
									<span value="$100" id="shipping-total" name="shipping-price">$100</span>
								</td>
							</tr>
							<tr id="vat-display">
								<td>
									<p>VAT</p>
								</td>
								<td>
									<span value="$500" id="vat-total" name="vat-price">$500</span>
								</td>
							</tr>
							<tr>
								<td>
									<p style="font-weight: 700;">Total</p>
								</td>
								<td>
									<span style="font-weight: 700;" type="text" value="$2500" id="price-total" name="total-price" disabled>$2500</span>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
		    </div>
		    <div class="box 4u 12u(small) sticky-quote" style="padding: 2em">
				<div class="">
					<h3>Payment</h3>
					<p>Pay now to complete your purchase.</p>
<!-- 					<div id="decode">
					</div> -->
					<div style="margin-bottom: 2em;">
						<label>Total Deposit (USD)</label>
						<input style="font-weight: 700;" type="text" value="${{page.price-usd}}" id="deposit-price" name="total-price" disabled></input>
						<input style="font-weight: 700; display: none;" type="text" value="${{page.guitar-type}}" id="guitar-type" name="type" disabled></input>
					</div>
			      	<div id="paypal-button-container"></div>
					<script>
						paypal.Buttons({
						    createOrder: function(data, actions) {
						      // This function sets up the details of the transaction, including the amount and line item details.
						      return actions.order.create({
						        purchase_units: [{
						          amount: {
						            value: deposit_price
						          }
						        }]
						      });
						    },
						    onApprove: function(data, actions) {
						      // This function captures the funds from the transaction.
						      return actions.order.capture().then(function(details) {
						        // This function shows a transaction success message to your buyer.
						        alert('Transaction completed by ' + details.payer.name.given_name);
						      });
						    }
						  }).render('#paypal-button-container');
		  			</script>
				</div>
			</div>
	  	</div>
	</div>
</section>

</div>

    {% include footer.html %}

</body>
</html>

<!-- URL Parameters -->
<script type="text/javascript">
window.addEventListener('DOMContentLoaded', function() {
  const urlParams = new URLSearchParams(window.location.search);
  const encodedData = urlParams.get('data');

  // Remove the ? character from the beginning of the string
  const decodedData = atob(encodedData);

  const paramsArray = decodedData.split('&');
  const paramsObject = {};

  paramsArray.forEach(function(param, index) {
    if (index === 0) {
      param = param.substring(1);
    }
    const [key, value] = param.split('=');
    const decodedValue = value ? decodeURIComponent(value.replace(/\+/g, '%20')) : '';
    paramsObject[key] = decodedValue;
    console.log(key + ': ' + decodedValue);
  });

  const price = parseFloat(paramsObject.price || 0);
  document.getElementById('payment-total').value = '$' + sum;

  // Get the table element
	const table = document.getElementById('my-table');

	// Loop through the paramsObject
	for (const [key, value] of Object.entries(paramsObject)) {
	  // Create a new table row
	  const row = document.createElement('tr');

	  // Create the first cell with the key as text
	  const cell1 = document.createElement('td');
	  cell1.textContent = key;
	  row.appendChild(cell1);

	  // Create the second cell with the value as a span
	  const cell2 = document.createElement('td');
	  const span = document.createElement('span');
	  span.textContent = value;
	  span.setAttribute('value', value);
	  span.setAttribute('id', `${key}-total`);
	  span.setAttribute('name', `${key}-price`);
	  cell2.appendChild(span);
	  row.appendChild(cell2);

	  // Append the row to the table
	  table.appendChild(row);
	}
});

</script>